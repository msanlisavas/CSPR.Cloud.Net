# CSPR.Cloud.Net - Complete Usage Guide

## What Is This?
A .NET client library for the CSPR Cloud API - access Casper blockchain data (Mainnet & Testnet) with type-safe methods, filtering, sorting, and pagination.

**Targets:** .NET Standard 2.0 & 2.1 (compatible with .NET Core, .NET 5+, .NET Framework 4.6.1+)

## Installation
```bash
dotnet add package CSPR.Cloud.Net
```

## Quick Start
```csharp
using CSPR.Cloud.Net.Clients;
using CSPR.Cloud.Net.Objects.Config;

// Initialize with your API key
var config = new CasperCloudClientConfig("your-api-key");
var client = new CasperCloudRestClient(config);

// Use Mainnet or Testnet
var account = await client.Mainnet.Account.GetAccountAsync("01abc...");
var validators = await client.Testnet.Validator.GetValidatorsAsync(new ValidatorsRequestParameters());
```

## Available Endpoints
Access via `client.Mainnet.{Endpoint}` or `client.Testnet.{Endpoint}`:

| Endpoint | Description |
|----------|-------------|
| `.Account` | Account data and info |
| `.Auction` | Auction metrics |
| `.Bidder` | Bidder/staking data |
| `.Block` | Block information |
| `.CentralizedAccount` | Exchange/service account info |
| `.Contract` | Smart contracts and packages |
| `.Delegate` | Delegations and rewards |
| `.Deploy` | Deploy transactions |
| `.FT` | Fungible tokens (CEP-18) |
| `.NFT` | Non-fungible tokens (CEP-78) |
| `.Rate` | CSPR currency rates |
| `.Supply` | Token supply data |
| `.Transfer` | CSPR transfers |
| `.Validator` | Validator info and performance |

---

## API Methods

### Account
```csharp
// Get single account
var account = await client.Mainnet.Account.GetAccountAsync("01publicKey...");

// Get single account with optional data
var account = await client.Mainnet.Account.GetAccountAsync("01publicKey...",
    new AccountsOptionalParameters { DelegatedBalance = true, AccountInfo = true });

// Get multiple accounts with filtering, sorting, pagination
var accounts = await client.Mainnet.Account.GetAccountsAsync(new AccountsRequestParameters
{
    PageNumber = 1,
    PageSize = 50,
    FilterParameters = new AccountsFilterParameters
    {
        AccountHashes = new List<string> { "account-hash-abc...", "account-hash-def..." }
    },
    SortingParameters = new AccountsSortingParameters
    {
        OrderByBalance = true,
        SortType = SortType.Descending
    },
    OptionalParameters = new AccountsOptionalParameters
    {
        AuctionStatus = true,
        StakedBalance = true
    }
});

// Get account info (extended metadata)
var info = await client.Mainnet.Account.GetAccountInfoAsync("account-hash-abc...");

// Get multiple account infos
var infos = await client.Mainnet.Account.GetAccountInfosAsync(new AccountInfosRequestParameters());
```

### Block
```csharp
// Get block by hash
var block = await client.Mainnet.Block.GetBlockAsync("block-hash...");

// Get blocks with pagination
var blocks = await client.Mainnet.Block.GetBlocksAsync(new BlockRequestParameters
{
    PageNumber = 1,
    PageSize = 25,
    SortingParameters = new BlockSortingParameters
    {
        OrderByHeight = true,
        SortType = SortType.Descending
    }
});

// Get blocks filtered by era and switch block status
var switchBlocks = await client.Mainnet.Block.GetBlocksAsync(new BlockRequestParameters
{
    FilterParameters = new BlockFilterParameters
    {
        EraId = "12345",
        IsSwitchBlock = true
    }
});

// Get blocks proposed by a validator
var validatorBlocks = await client.Mainnet.Block.GetValidatorBlocksAsync(
    "01validatorPublicKey...",
    new BlockRequestParameters());
```

### Validator
```csharp
// Get single validator
var validator = await client.Mainnet.Validator.GetValidatorAsync(
    "01publicKey...",
    new ValidatorRequestParameters());

// Get all validators
var validators = await client.Mainnet.Validator.GetValidatorsAsync(new ValidatorsRequestParameters
{
    PageSize = 100,
    FilterParameters = new ValidatorsFilterParameters
    {
        IsActive = true
    },
    SortingParameters = new ValidatorsSortingParameters
    {
        OrderByStake = true,
        SortType = SortType.Descending
    },
    OptionalParameters = new ValidatorsOptionalParameters
    {
        AccountInfo = true
    }
});

// Get validator performance history
var performance = await client.Mainnet.Validator.GetHistoricalValidatorPerformanceAsync(
    "01publicKey...",
    new ValidatorHistoricalPerformanceRequestParameters());

// Get validator rewards
var rewards = await client.Mainnet.Validator.GetValidatorRewardsAsync(
    "01publicKey...",
    new ValidatorRewardsRequestParameters());

// Get total rewards
var totalRewards = await client.Mainnet.Validator.GetValidatorTotalRewardsAsync("01publicKey...");
```

### Deploy
```csharp
// Get single deploy
var deploy = await client.Mainnet.Deploy.GetDeployAsync("deploy-hash...");

// Get deploys with filtering
var deploys = await client.Mainnet.Deploy.GetDeploysAsync(new DeploysRequestParameters
{
    FilterParameters = new DeploysFilterParameters
    {
        CallerPublicKey = "01abc..."
    }
});

// Get account's deploys
var accountDeploys = await client.Mainnet.Deploy.GetAccountDeploysAsync(
    "01publicKey...",
    new AccountDeploysRequestParameters());

// Get block's deploys
var blockDeploys = await client.Mainnet.Deploy.GetBlockDeploysAsync(
    "block-hash...",
    new BlockDeploysRequestParameters());

// Get deploy execution types
var types = await client.Mainnet.Deploy.GetDeployExecutionTypesAsync();
```

### Delegate
```csharp
// Get account's delegations
var delegations = await client.Mainnet.Delegate.GetAccountDelegationsAsync(
    "01publicKey...",
    new DelegationRequestParameters());

// Get validator's delegators
var delegators = await client.Mainnet.Delegate.GetValidatorDelegationsAsync(
    "01validatorPublicKey...",
    new DelegationRequestParameters());

// Get delegator rewards
var rewards = await client.Mainnet.Delegate.GetAccountDelegatorRewardsAsync(
    "01publicKey...",
    new AccountDelegatorRewardRequestParameters());

// Get total delegation rewards
var total = await client.Mainnet.Delegate.GetTotalAccountDelegationRewardsAsync("01publicKey...");
```

### Transfer
```csharp
// Get account transfers
var transfers = await client.Mainnet.Transfer.GetAccountTransfersAsync(
    "01publicKey...",
    new TransferAccountRequestParameters
    {
        SortingParameters = new TransferSortingParameters
        {
            OrderByTimestamp = true,
            SortType = SortType.Descending
        }
    });

// Get deploy transfers
var deployTransfers = await client.Mainnet.Transfer.GetDeployTransfersAsync(
    "deploy-hash...",
    new TransferDeployRequestParameters());
```

### Contract
```csharp
// Get contract by hash
var contract = await client.Mainnet.Contract.GetContractAsync("contract-hash...");

// Get contracts
var contracts = await client.Mainnet.Contract.GetContractsAsync(new ContractsRequestParameters());

// Get contract types
var types = await client.Mainnet.Contract.GetContractTypesAsync();

// Get contract entry points
var entryPoints = await client.Mainnet.Contract.GetContractEntryPointsAsync("contract-hash...");

// Get entry point costs
var costs = await client.Mainnet.Contract.GetContractEntryPointCostsAsync(
    "contract-hash...",
    "entry_point_name");

// Get contract package
var package = await client.Mainnet.Contract.GetContractPackageAsync("contract-package-hash...");

// Get account's contract packages
var packages = await client.Mainnet.Contract.GetAccountContractPackagesAsync("01publicKey...");
```

### NFT (Non-Fungible Tokens)
```csharp
// Get single NFT
var nft = await client.Mainnet.NFT.GetNFTAsync("contract-package-hash...", "token-id");

// Get account's NFTs
var nfts = await client.Mainnet.NFT.GetAccountNFTsAsync(
    "01publicKey...",
    new NFTAccountRequestParameters
    {
        OptionalParameters = new NFTOptionalParameters
        {
            OffchainMetadata = true
        }
    });

// Get contract package NFTs
var collectionNfts = await client.Mainnet.NFT.GetContractPackageNFTsAsync(
    "contract-package-hash...",
    new NFTContractPackageRequestParameters());

// Get NFT actions (transfers, mints, burns)
var actions = await client.Mainnet.NFT.GetAccountNFTActionsAsync(
    "01publicKey...",
    new NFTAccountActionsRequestParameters());

// Get NFT ownership
var ownership = await client.Mainnet.NFT.GetAccountNFTOwnershipAsync(
    "01publicKey...",
    new NFTAccountOwnershipRequestParameters());

// Get supported NFT standards
var standards = await client.Mainnet.NFT.GetNFTStandardsAsync();

// Get NFT action types
var actionTypes = await client.Mainnet.NFT.GetNFTActionTypesAsync();
```

### FT (Fungible Tokens)
```csharp
// Get fungible token actions
var actions = await client.Mainnet.FT.GetFungibleTokenActionsAsync(
    new FTActionRequestParameters());

// Get account's FT actions
var accountActions = await client.Mainnet.FT.GetAccountFungibleTokenActionsAsync(
    "01publicKey...",
    new FTAccountActionRequestParameters());

// Get account's FT ownership (balances)
var balances = await client.Mainnet.FT.GetAccountFungibleTokenOwnershipAsync(
    "01publicKey...",
    new FTAccountOwnershipRequestParameters());

// Get contract package FT ownership
var holders = await client.Mainnet.FT.GetContractPackageFungibleTokenOwnershipAsync(
    "contract-package-hash...",
    new FTContractPackageOwnershipRequestParameters());
```

### Bidder
```csharp
// Get bidder info
var bidder = await client.Mainnet.Bidder.GetBidderAsync(
    "01publicKey...",
    new BidderRequestParameters());

// Get all bidders
var bidders = await client.Mainnet.Bidder.GetBiddersAsync(new BiddersRequestParameters
{
    FilterParameters = new BiddersFilterParameters
    {
        AuctionStatus = AuctionStatus.ActiveValidator
    }
});
```

### Rate
```csharp
// Get current CSPR rate
var rate = await client.Mainnet.Rate.GetCurrentCurrencyRateAsync("usd");

// Get historical rates
var history = await client.Mainnet.Rate.GetHistoricalCurrencyRatesAsync(
    "usd",
    new RateHistoricalRequestParameters());

// Get supported currencies
var currencies = await client.Mainnet.Rate.GetCurrenciesAsync();
```

### Supply
```csharp
// Get CSPR supply info
var supply = await client.Mainnet.Supply.GetSupplyAsync();
```

### Auction
```csharp
// Get auction metrics
var metrics = await client.Mainnet.Auction.GetAuctionMetricsAsync();
```

### Centralized Account
```csharp
// Get exchange/service account info
var info = await client.Mainnet.CentralizedAccount.GetCentralizedAccountInfoAsync("account-hash...");

// Get all centralized accounts
var accounts = await client.Mainnet.CentralizedAccount.GetCentralizedAccountInfosAsync(
    new CentralizedAccountInfoRequestParameters());
```

---

## Response Types

### Single Item Response
```csharp
Response<T> response = await client.Mainnet.Account.GetAccountAsync("01abc...");
AccountData account = response.Data;
```

### List Response
```csharp
ListResponse<T> response = await client.Mainnet.NFT.GetNFTStandardsAsync();
List<NFTStandardData> standards = response.Data;
```

### Paginated Response
```csharp
PaginatedResponse<T> response = await client.Mainnet.Account.GetAccountsAsync(params);
List<AccountData> accounts = response.Data;
int totalItems = response.ItemCount;
int totalPages = response.PageCount;
```

---

## Parameter System

### Pagination (all list endpoints)
```csharp
var params = new AccountsRequestParameters
{
    PageNumber = 1,      // Default: 1
    PageSize = 50        // Default: 10, Max: 250
};
```

### Filtering
Filter results by specific criteria:
```csharp
FilterParameters = new ValidatorsFilterParameters
{
    IsActive = true,
    PublicKeys = new List<string> { "01abc...", "01def..." }
}
```

### Sorting
```csharp
SortingParameters = new AccountsSortingParameters
{
    OrderByBalance = true,           // or OrderByTotalBalance
    SortType = SortType.Descending   // or SortType.Ascending
}
```

### Optional Includes
Request additional data fields:
```csharp
OptionalParameters = new AccountsOptionalParameters
{
    AuctionStatus = true,
    DelegatedBalance = true,
    UndelegatingBalance = true,
    StakedBalance = true,
    AccountInfo = true,
    CentralizedAccountInfo = true
}
```

---

## Key Data Models

### AccountData
```csharp
string PublicKey
string AccountHash
ulong Balance
ulong TotalBalance
// Optional (when requested):
string AuctionStatus
ulong? DelegatedBalance
ulong? UndelegatingBalance
ulong? StakedBalance
AccountInfoData AccountInfo
```

### ValidatorData
```csharp
string PublicKey
string AccountHash
bool IsActive
ulong Stake
int DelegatorCount
decimal DelegationRate
int FeePercentage
decimal Performance
AccountInfoData AccountInfo
```

### BlockData
```csharp
string BlockHash
ulong BlockHeight
ulong EraId
string Proposer
DateTime Timestamp
int DeployCount
int TransferCount
```

### DeployData
```csharp
string DeployHash
string CallerPublicKey
string BlockHash
string ContractHash
ulong Cost
string Status
DateTime Timestamp
string ErrorMessage
```

### NFTTokenData
```csharp
string TokenId
string ContractPackageHash
string OwnerPublicKey
string OwnerAccountHash
bool IsOwnerAccount
int TokenStandardId
object OnchainMetadata
object OffchainMetadata
DateTime Timestamp
```

### FTOwnershipData
```csharp
string OwnerPublicKey
string OwnerAccountHash
string ContractPackageHash
string Balance
```

### DelegationData
```csharp
string PublicKey
string ValidatorPublicKey
ulong StakedAmount
ulong BondingPurse
```

### TransferData
```csharp
string DeployHash
string FromAccount
string ToAccount
ulong Amount
DateTime Timestamp
```

---

## Enums

### SortType
```csharp
SortType.Ascending   // ASC
SortType.Descending  // DESC
```

### AuctionStatus
```csharp
AuctionStatus.InactiveBidder
AuctionStatus.ActiveBidder
AuctionStatus.ActiveValidator
AuctionStatus.PendingValidator
```

### HashType / OwnerType
```csharp
HashType.Account
HashType.Contract

OwnerType.Account
OwnerType.Contract
```

---

## Error Handling

```csharp
using CSPR.Cloud.Net.Errors;

try
{
    var account = await client.Mainnet.Account.GetAccountAsync("01abc...");
}
catch (UnauthorizedException)
{
    // 401 - Invalid or missing API key
}
catch (NotFoundException)
{
    // 404 - Resource not found
}
catch (InvalidParamException)
{
    // 400 - Invalid parameters
}
catch (AccessDeniedException)
{
    // 403 - Access denied
}
catch (InternalServerErrorException)
{
    // 500 - Server error
}
```

---

## Advanced Configuration

### Custom HttpClient
```csharp
var httpClient = new HttpClient();
httpClient.Timeout = TimeSpan.FromSeconds(60);

var client = new CasperCloudRestClient(config, httpClient);
```

### With Logging
```csharp
var loggerFactory = LoggerFactory.Create(builder =>
    builder.AddConsole().SetMinimumLevel(LogLevel.Debug));

var client = new CasperCloudRestClient(config, loggerFactory: loggerFactory);
```

---

## Complete Example

```csharp
using CSPR.Cloud.Net.Clients;
using CSPR.Cloud.Net.Objects.Config;
using CSPR.Cloud.Net.Parameters.Wrapper.Validator;
using CSPR.Cloud.Net.Parameters.Sorting.Validator;
using CSPR.Cloud.Net.Parameters.OptionalParameters.Validator;
using CSPR.Cloud.Net.Enums;

var config = new CasperCloudClientConfig("your-api-key");
var client = new CasperCloudRestClient(config);

// Get top 10 validators by stake with account info
var validators = await client.Mainnet.Validator.GetValidatorsAsync(new ValidatorsRequestParameters
{
    PageNumber = 1,
    PageSize = 10,
    SortingParameters = new ValidatorsSortingParameters
    {
        OrderByStake = true,
        SortType = SortType.Descending
    },
    OptionalParameters = new ValidatorsOptionalParameters
    {
        AccountInfo = true
    }
});

foreach (var validator in validators.Data)
{
    Console.WriteLine($"{validator.AccountInfo?.Info?.Name ?? validator.PublicKey}");
    Console.WriteLine($"  Stake: {validator.Stake / 1_000_000_000m} CSPR");
    Console.WriteLine($"  Delegators: {validator.DelegatorCount}");
    Console.WriteLine($"  Fee: {validator.FeePercentage}%");
}

Console.WriteLine($"\nTotal validators: {validators.ItemCount}");
```

---

## API Reference Links
- CSPR Cloud API Docs: https://docs.cspr.cloud
- Casper Network: https://casper.network
